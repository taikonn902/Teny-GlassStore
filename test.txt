document.addEventListener('DOMContentLoaded', function() {
    var cartItems = [];
    var cartItemsContainer = document.querySelector('.cart-item');
    var cartLength = document.querySelector('.shopping-cart-page .lenght-cart');
    var totalCartPrice = document.querySelector('.cart-total span');
    var decreaseBtn = document.querySelector('.decrease-detail-page-btn');
    var increaseBtn = document.querySelector('.increase-detail-page-btn');
    var quantityDisplay = document.querySelector('.quantity-product-detail');
    var selectedColor = '';
    var remainingStock = parseInt(document.querySelector('.remaining-stock').textContent);

    checkCartEmpty();

    if (localStorage.getItem('cartItems')) {
        cartItems = JSON.parse(localStorage.getItem('cartItems'));
        updateCartLength();
    } else {
        cartLength.textContent = '0';
        totalCartPrice.textContent = '0đ';
    }

    function checkCartEmpty() {
        if (cartItems.length === 0) {
            if (cartItemsContainer) {
                cartItemsContainer.innerHTML = '<img class="cart-item-null" src="../images/cart-item-null.jpeg">';
            } else {
                console.error('Không tìm thấy phần tử có lớp ".cart-item .cart-popup-mid"');
            }
        }
    }

    function updateCartLength() {
        var totalQuantity = calculateTotalQuantity();
        cartLength.textContent = totalQuantity;
    }

    function calculateTotalQuantity() {
        var total = 0;
        cartItems.forEach(function(item) {
            total += item.quantity;
        });
        return total;
    }

    var colorBoxes = document.querySelectorAll('.color-box');
    colorBoxes.forEach(function(box) {
        box.addEventListener('click', function() {
            colorBoxes.forEach(function(b) {
                b.classList.remove('selected');
            });

            this.classList.add('selected');

            selectedColor = this.dataset.color;
        });
    });

    var addToCartBtn = document.querySelector('.add-to-cart-detail');
    addToCartBtn.addEventListener('click', function() {
        var productInfo = {
            color: selectedColor,
            quantity: parseInt(document.querySelector('.quantity-product-detail').textContent),
            price: parseFloat(document.querySelector('.show-price-detail').textContent.replace('đ', '').replace('.', '')),
        };

        console.log('Thông tin sản phẩm để thêm vào giỏ hàng:', productInfo);
    });

    function updateButtonStates() {
        var quantity = parseInt(quantityDisplay.textContent);
        if (quantity <= 1) {
            decreaseBtn.style.cursor = 'not-allowed';
            decreaseBtn.disabled = true;
        } else {
            decreaseBtn.style.cursor = 'pointer';
            decreaseBtn.disabled = false;
        }

        if (quantity >= remainingStock) {
            increaseBtn.style.cursor = 'not-allowed';
            increaseBtn.disabled = true;
        } else {
            increaseBtn.style.cursor = 'pointer';
            increaseBtn.disabled = false;
        }
    }

    decreaseBtn.addEventListener('click', function() {
        var quantity = parseInt(quantityDisplay.textContent);
        if (quantity > 1) {
            quantity--;
            quantityDisplay.textContent = quantity;
        }
        updateButtonStates();
    });

    increaseBtn.addEventListener('click', function() {
        var quantity = parseInt(quantityDisplay.textContent);
        if (quantity < remainingStock) {
            quantity++;
            quantityDisplay.textContent = quantity;
        }
        updateButtonStates();
    });

    // Khởi tạo trạng thái của các nút khi DOM được tải xong
    updateButtonStates();
});
